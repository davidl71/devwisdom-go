# devwisdom-go Development Rules

## Project Configuration

- **Project Root**: `/Users/davidl/Projects/devwisdom-go`
- **Project ID**: `039bb05a-6f78-492b-88b5-28fdfa3ebce7` (agentic-tools MCP)
- **Repository**: <https://github.com/davidl71/devwisdom-go>
- **Type**: Standalone Go MCP Server

**IMPORTANT**: When generating project scorecards, reports, or performing project-wide operations, ensure the project root is set to `/Users/davidl/Projects/devwisdom-go`. Use `PROJECT_ROOT` environment variable or ensure tools detect this directory as the project root.

## Language & Framework

- **Language**: Go 1.21+
- **Framework**: Standard library + MCP protocol (JSON-RPC 2.0)
- **Build Tool**: Make
- **Testing**: Go testing package

## Makefile Usage (CRITICAL)

**⚠️ ALWAYS USE MAKEFILE TARGETS INSTEAD OF DIRECT COMMANDS ⚠️**

**Before running any command, check if a Makefile target exists. Use `make <target>` instead of generating files or running commands directly.**

### Available Makefile Targets

**Build Operations:**

- `make build` - Build MCP server binary (devwisdom)
- `make build-cli` - Build CLI binary (devwisdom-cli)
- `make build-all` - Build both server and CLI
- `make build-windows` - Build Windows binaries
- `make build-linux` - Build Linux binaries
- `make build-darwin` - Build macOS binaries
- `make build-all-platforms` - Build for all platforms
- `make build-release` - Build and package release archives

**Development Operations:**

- `make run` - Run server (builds first)
- `make watchdog` - Run with file watching
- `make watchdog-restart` - Run with auto-restart on changes
- `make watchdog-monitor` - Run with crash monitoring only

**Testing:**

- `make test` - Run all tests
- `make test-coverage` - Run tests with coverage (text)
- `make test-html` - Run tests with coverage (HTML)
- `make test-wisdom` - Run wisdom package tests

**Code Quality:**

- `make fmt` - Format code (go fmt)
- `make lint` - Lint code (golangci-lint)
- `make clean` - Clean build artifacts (includes clean-dist)
- `make clean-dist` - Clean distribution directory only

**Installation:**

- `make install` - Install MCP server globally
- `make install-cli` - Install CLI globally
- `make install-all` - Install both globally

**Benchmarking & Profiling:**

- `make bench` - Run benchmarks
- `make bench-cpu` - Run benchmarks with CPU profiling
- `make bench-mem` - Run benchmarks with memory profiling
- `make bench-profile` - Run with both CPU and memory profiling
- `make pprof-cpu` - Analyze CPU profile (interactive)
- `make pprof-mem` - Analyze memory profile (interactive)
- `make pprof-web-cpu` - CPU profile web interface (<http://localhost:8080>)
- `make pprof-web-mem` - Memory profile web interface (<http://localhost:8080>)

**Documentation:**

- `make docs` - Start godoc server (<http://localhost:6060>)

### Rules for AI

1. **NEVER run `go build` directly** - Use `make build` or `make build-cli` instead
2. **NEVER run `go test` directly** - Use `make test`, `make test-coverage`, or `make test-html` instead
3. **NEVER run `golangci-lint` directly** - Use `make lint` instead
4. **NEVER run `go fmt` directly** - Use `make fmt` instead
5. **NEVER create build scripts** - Use existing Makefile targets
6. **NEVER generate wrapper scripts** - Use `make run` or watchdog targets
7. **ALWAYS check Makefile first** - Before suggesting any command, verify if a Makefile target exists
8. **PREFER Makefile targets** - When multiple options exist, choose the Makefile target

### Examples

**❌ WRONG:**

```bash
go build -o devwisdom ./cmd/server
go test ./...
golangci-lint run ./...
```

**✅ CORRECT:**

```bash
make build
make test
make lint
```

**Exception:** Only use direct commands when:

- The operation is not covered by any Makefile target
- You need to pass custom flags not supported by Makefile targets
- You're debugging a specific issue that requires direct command execution

## Code Style

- Follow Go conventions (gofmt, golint)
- Use meaningful variable names
- Keep functions focused and small
- Document all public APIs with godoc comments

## Project Structure

- `cmd/server/` - MCP server entry point
- `internal/wisdom/` - Wisdom engine (quotes, sources, advisors)
- `internal/mcp/` - MCP protocol handler
- `internal/config/` - Configuration management

## MCP Protocol

- Implement JSON-RPC 2.0 handler
- Register 5 tools: consult_advisor, get_wisdom, get_daily_briefing, get_consultation_log, export_for_podcast
- Register 4 resources: wisdom://sources, wisdom://advisors, wisdom://advisor/{id}, wisdom://consultations/{days}
- Use stdio transport

## Testing

- Write unit tests for all public functions
- Aim for >80% test coverage
- Use table-driven tests where appropriate

## Dependencies

- Prefer standard library
- Only add external deps when necessary
- Document why each dependency is needed

## Task Management

- Tasks tracked in agentic-tools MCP (Project ID: 039bb05a-6f78-492b-88b5-28fdfa3ebce7)
- Use PROJECT_GOALS.md for phase alignment
- Follow TODO.md for task breakdown

## MCP Tool Call Requirements

**⚠️ CRITICAL: Always provide required parameters when calling MCP tools**

### Todo2 MCP Tools (`mcp_extension-todo2_*`)

**Common Mistake**: Calling `update_todos` without the required `updates` parameter array.

**❌ INCORRECT**:

```python
mcp_extension-todo2_update_todos()  # Missing required 'updates' parameter
```

**✅ CORRECT**:

```python
mcp_extension-todo2_update_todos(
    updates=[
        {
            "id": "T-2",
            "status": "Review"
        },
        {
            "id": "T-0", 
            "status": "Review"
        }
    ]
)
```

### Required Parameters for Todo2 Tools

1. **`update_todos`**:
   - **REQUIRED**: `updates` (array of update objects)
   - Each update object must have `id` (required)
   - Optional: `status`, `priority`, `tags`, `dependencies`, `long_description`, `cursorInsight`
   - Valid status values: `"Todo"`, `"In Progress"`, `"Done"` (Note: "Review" is valid in Todo2 JSON but not in the tool enum - use direct JSON update if needed)

2. **`create_todos`**:
   - **REQUIRED**: `todos` (array of todo objects)
   - Each todo must have `name` and `long_description`

3. **`add_comments`**:
   - **REQUIRED**: `todoId` (string) and `comments` (array of comment objects)
   - Each comment must have `type` and `content`

4. **`get_todo_details`**:
   - **REQUIRED**: `ids` (array of todo ID strings)

5. **`delete_todos`**:
   - **REQUIRED**: `ids` (array of todo ID strings)

### When to Use Direct JSON Updates vs MCP Tools

- **Use MCP Tools**: When the tool supports the operation and all required parameters are available
- **Use Direct JSON Updates**: When:
  - The tool enum doesn't support a needed value (e.g., "Review" status in `update_todos`)
  - You need to make bulk changes that the tool doesn't support efficiently
  - The tool call fails due to parameter validation issues

**Always verify tool parameters before calling** - check the tool definition for required vs optional parameters.
